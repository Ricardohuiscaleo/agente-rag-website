import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as c}from"./index.Bd8wGOW-.js";import"./supabase.CsEe2xpb.js";import"./_commonjsHelpers.D6-XlEtG.js";import"./index.c0qeY2gs.js";import"./preload-helper.BlTxHScW.js";const He=({step:v,loadingState:u,progress:m=0})=>{const[l,g]=c.useState(""),[N,x]=c.useState(""),[f,D]=c.useState(0),C={calendar:["🤖 IA analizando disponibilidad de horarios...","📅 Procesando eventos del calendario...","⚡ Calculando slots disponibles...","🔍 Verificando conflictos de horarios...","✨ Optimizando horarios disponibles...","🎯 Encontrando las mejores opciones para ti...","⏰ Sincronizando con el calendario principal..."],timeSlots:["🧠 IA calculando horarios óptimos...","⏰ Analizando ventanas de tiempo...","📊 Evaluando disponibilidad...","🎯 Encontrando mejores opciones...","🔄 Actualizando disponibilidad en tiempo real...","✅ Validando horarios seleccionables..."],tempBlock:["🔒 IA reservando temporalmente tu horario...","⚡ Creando bloqueo de seguridad...","🛡️ Protegiendo tu selección...","✅ Confirmando reserva temporal...","⏱️ Iniciando contador de tiempo protegido...","🔐 Asegurando tu horario elegido..."],formProcessing:["🤖 IA validando tus datos personales...","📝 Procesando información de contacto...","🔍 Verificando formato de email...","✨ Preparando tu perfil de reserva...","🛡️ Protegiendo tu información personal...","📋 Completando validación de datos..."],finalBooking:["🚀 IA creando tu reserva definitiva...","📧 Generando confirmación por email...","📅 Sincronizando con calendario principal...","🎉 Completando tu asesoría RAG...","✅ Finalizando proceso de reserva...","📬 Preparando notificaciones automáticas...","🔔 Configurando recordatorios inteligentes..."]},b={1:"Paso 1: Selección de Horario",2:"Paso 2: Datos Personales",3:"Paso 3: Confirmación y Pago"},P={1:"Nuestro asistente IA está analizando tu calendario para encontrar los mejores horarios disponibles",2:"La IA está validando y procesando tu información personal de forma segura",3:"Finalizando tu reserva con la máxima seguridad y confirmación automática"};return c.useEffect(()=>{const k=C[u]||["🤖 IA procesando..."];let p=0;const W=setInterval(()=>{g(k[p]),p=(p+1)%k.length,D(p)},2e3),R=setInterval(()=>{x(T=>T==="..."?"":T+".")},500);return()=>{clearInterval(W),clearInterval(R)}},[u]),e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 px-4 space-y-6 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border border-blue-200",children:[v&&e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:b[v]}),e.jsx("div",{className:"w-16 h-1 bg-gradient-to-r from-blue-500 to-indigo-600 mx-auto rounded-full"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center animate-pulse",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})})})}),e.jsx("div",{className:"absolute -inset-2",children:e.jsx("div",{className:"w-24 h-24 border-2 border-purple-200 rounded-full animate-ping opacity-60"})})]}),e.jsxs("div",{className:"text-center max-w-md",children:[e.jsxs("p",{className:"text-gray-700 font-medium mb-2 text-lg",children:[l,N]}),m>0&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-3",children:e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 h-2 rounded-full transition-all duration-300 relative overflow-hidden",style:{width:`${m}%`},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-30 animate-pulse"}),e.jsx("div",{className:"absolute top-0 right-0 w-2 h-full bg-white opacity-50 animate-pulse"})]})}),e.jsx("p",{className:"text-sm text-gray-500",children:v&&P[v]})]}),e.jsx("div",{className:"flex space-x-2",children:[0,1,2].map(k=>e.jsx("div",{className:`w-2 h-2 rounded-full transition-all duration-300 ${k===f%3?"bg-blue-600 animate-bounce scale-125":k===(f-1)%3?"bg-blue-400 scale-110":"bg-blue-200"}`,style:{animationDelay:`${k*.1}s`}},k))}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500 max-w-sm",children:[e.jsx("span",{className:"font-medium text-blue-600",children:"Tu asistente IA personal"})," está optimizando cada detalle para garantizar la mejor experiencia en tu asesoría RAG"]})})]})},Ue=({stage:v="validating"})=>{const[u,m]=c.useState(0),[l,g]=c.useState(0),N={validating:{title:"🔍 IA Validando Datos",message:"Verificando y protegiendo tu información personal...",steps:["Verificando nombre completo","Validando email corporativo","Confirmando teléfono","Protegiendo datos"]},creating:{title:"🚀 IA Creando Reserva",message:"Procesando tu solicitud de asesoría...",steps:["Procesando solicitud","Generando confirmación","Preparando email","Sincronizando calendario"]},finalizing:{title:"✨ IA Finalizando",message:"Completando tu asesoría RAG...",steps:["Sincronizando calendario","Configurando recordatorios","Preparando notificaciones","Finalizando reserva"]}};c.useEffect(()=>{const f=setInterval(()=>{m(D=>{const C=D+Math.random()*8;if(C>=100)return 100;const b=Math.floor(C/100*N[v].steps.length);return g(b),C})},400);return()=>clearInterval(f)},[v]);const x=N[v];return e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 px-6 space-y-8 bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-50 rounded-xl border border-purple-200 shadow-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-purple-500 via-blue-500 to-indigo-600 rounded-full flex items-center justify-center shadow-xl",children:e.jsx("svg",{className:"w-12 h-12 text-white animate-pulse",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})})}),e.jsx("div",{className:"absolute -top-2 -right-2 w-8 h-8 bg-green-500 rounded-full flex items-center justify-center animate-bounce",children:e.jsx("div",{className:"w-4 h-4 bg-white rounded-full animate-ping"})}),e.jsx("div",{className:"absolute -inset-4",children:e.jsx("div",{className:"w-32 h-32 border-2 border-purple-300 rounded-full animate-ping opacity-60"})})]}),e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:x.title}),e.jsx("p",{className:"text-gray-600 text-sm",children:x.message})]}),e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mb-2",children:[e.jsx("span",{children:"Progreso"}),e.jsxs("span",{children:[Math.round(u),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:e.jsxs("div",{className:"bg-gradient-to-r from-purple-500 via-blue-500 to-indigo-600 h-3 rounded-full transition-all duration-500 relative",style:{width:`${Math.min(u,100)}%`},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-30 animate-pulse"}),e.jsx("div",{className:"absolute top-0 right-0 w-2 h-full bg-white opacity-50 animate-pulse"})]})})]}),e.jsx("div",{className:"space-y-3 w-full max-w-md",children:x.steps.map((f,D)=>{const C=l>D,b=l===D;return e.jsxs("div",{className:"flex items-center space-x-3 text-sm",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center transition-all duration-300 ${C?"bg-green-500 text-white":b?"bg-blue-500 text-white animate-pulse":"bg-gray-200 text-gray-400"}`,children:C?e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):e.jsx("span",{className:"text-xs font-bold",children:D+1})}),e.jsx("span",{className:`transition-all duration-300 ${C?"text-green-600 font-medium line-through":b?"text-blue-600 font-medium":"text-gray-500"}`,children:f}),b&&e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-1 h-1 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-1 h-1 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-1 h-1 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]},D)})}),e.jsx("div",{className:"text-center bg-white/50 rounded-lg p-4 max-w-md",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-bold text-purple-600",children:"Sistema IA Avanzado"})," procesando tu información con máxima seguridad y precisión para optimizar tu experiencia de asesoría RAG"]})})]})},Xe=c.forwardRef(({selectedCountry:v,onCountryChange:u},m)=>{const[l,g]=c.useState(!1);c.useImperativeHandle(m,()=>({close:()=>g(!1)}));const N=[{code:"+56",country:"CL",name:"Chile",flag:"🇨🇱"},{code:"+54",country:"AR",name:"Argentina",flag:"🇦🇷"},{code:"+55",country:"BR",name:"Brasil",flag:"🇧🇷"},{code:"+57",country:"CO",name:"Colombia",flag:"🇨🇴"},{code:"+51",country:"PE",name:"Perú",flag:"🇵🇪"},{code:"+598",country:"UY",name:"Uruguay",flag:"🇺🇾"},{code:"+595",country:"PY",name:"Paraguay",flag:"🇵🇾"},{code:"+593",country:"EC",name:"Ecuador",flag:"🇪🇨"},{code:"+591",country:"BO",name:"Bolivia",flag:"🇧🇴"},{code:"+58",country:"VE",name:"Venezuela",flag:"🇻🇪"},{code:"+1",country:"US",name:"Estados Unidos",flag:"🇺🇸"},{code:"+34",country:"ES",name:"España",flag:"🇪🇸"},{code:"+52",country:"MX",name:"México",flag:"🇲🇽"}],x=f=>{u(f),g(!1)};return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>g(!l),className:"flex items-center px-3 py-2 border border-gray-300 rounded-l-md bg-gray-50 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors",children:[e.jsx("span",{className:"text-lg mr-2",children:v.flag}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:v.code}),e.jsx("svg",{className:`w-4 h-4 ml-1 transition-transform ${l?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),l&&e.jsx("div",{className:"absolute top-full left-0 z-50 w-64 mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto",children:N.map(f=>e.jsxs("button",{type:"button",onClick:()=>x(f),className:"w-full flex items-center px-3 py-2 text-left hover:bg-gray-100 focus:bg-gray-100 focus:outline-none transition-colors",children:[e.jsx("span",{className:"text-lg mr-3",children:f.flag}),e.jsx("span",{className:"text-sm font-medium text-gray-700 mr-2",children:f.code}),e.jsx("span",{className:"text-sm text-gray-600",children:f.name})]},f.country))})]})});class K{static{this.disposableEmailDomains=["10minutemail.com","guerrillamail.com","mailinator.com","tempmail.org","yopmail.com","throwaway.email","maildrop.cc","33mail.com","emailondeck.com","getnada.com","temp-mail.org","mohmal.com","sharklasers.com","grr.la","guerrillamailblock.com","pokemail.net","spam4.me","bccto.me","chacuo.net","deadaddress.com"]}static{this.emailRegex=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/}static validateEmail(u){const m=[],l=[];if(!u||u.trim().length===0)return m.push("El email es requerido"),{isValid:!1,errors:m,warnings:l};const g=u.trim().toLowerCase();this.emailRegex.test(g)||m.push("El formato del email no es válido"),g.length>254&&m.push("El email es demasiado largo (máximo 254 caracteres)");const[N,x]=g.split("@");if(N&&N.length>64&&m.push("La parte local del email es demasiado larga"),x){this.disposableEmailDomains.includes(x)&&l.push("Los emails temporales no son recomendados para reservas"),(x.includes("..")||x.startsWith(".")||x.endsWith("."))&&m.push("El dominio del email contiene caracteres inválidos");const f=x.split(".");(f.length<2||f[f.length-1].length<2)&&m.push("El dominio debe tener una extensión válida")}return{isValid:m.length===0,errors:m,warnings:l}}static isValidFormat(u){return this.emailRegex.test(u.trim().toLowerCase())}static normalize(u){return u.trim().toLowerCase()}static getDomain(u){const[,m]=u.split("@");return m||""}static isPopularDomain(u){const m=this.getDomain(u.toLowerCase());return["gmail.com","outlook.com","hotmail.com","yahoo.com","icloud.com","live.com","msn.com","aol.com","empresa.cl","uc.cl","usach.cl","udp.cl","uai.cl"].includes(m)}}class Z{static{this.phonePatterns={CL:{pattern:/^9[0-9]{8}$/,minLength:9,maxLength:9,description:"9 seguido de 8 dígitos (ej: 987654321)",example:"987654321"},AR:{pattern:/^[0-9]{10,11}$/,minLength:10,maxLength:11,description:"10-11 dígitos (ej: 1123456789)",example:"1123456789"},BR:{pattern:/^[0-9]{10,11}$/,minLength:10,maxLength:11,description:"10-11 dígitos (ej: 11987654321)",example:"11987654321"},CO:{pattern:/^3[0-9]{9}$/,minLength:10,maxLength:10,description:"3 seguido de 9 dígitos (ej: 3123456789)",example:"3123456789"},PE:{pattern:/^9[0-9]{8}$/,minLength:9,maxLength:9,description:"9 seguido de 8 dígitos (ej: 987654321)",example:"987654321"},UY:{pattern:/^9[0-9]{7}$/,minLength:8,maxLength:8,description:"9 seguido de 7 dígitos (ej: 98765432)",example:"98765432"},PY:{pattern:/^9[0-9]{8}$/,minLength:9,maxLength:9,description:"9 seguido de 8 dígitos (ej: 987654321)",example:"987654321"},EC:{pattern:/^[0-9]{9}$/,minLength:9,maxLength:9,description:"9 dígitos (ej: 987654321)",example:"987654321"},BO:{pattern:/^[67][0-9]{7}$/,minLength:8,maxLength:8,description:"6 o 7 seguido de 7 dígitos (ej: 71234567)",example:"71234567"},VE:{pattern:/^4[0-9]{9}$/,minLength:10,maxLength:10,description:"4 seguido de 9 dígitos (ej: 4123456789)",example:"4123456789"},US:{pattern:/^[0-9]{10}$/,minLength:10,maxLength:10,description:"10 dígitos (ej: 2025551234)",example:"2025551234"},ES:{pattern:/^[67][0-9]{8}$/,minLength:9,maxLength:9,description:"6 o 7 seguido de 8 dígitos (ej: 612345678)",example:"612345678"},MX:{pattern:/^[0-9]{10}$/,minLength:10,maxLength:10,description:"10 dígitos (ej: 5512345678)",example:"5512345678"}}}static validatePhone(u,m){const l=[],g=[];if(!u||u.trim().length===0)return l.push("El número de teléfono es requerido"),{isValid:!1,errors:l,suggestions:g};const N=u.replace(/[^0-9]/g,"");if(N.length===0)return l.push("Ingresa solo números en el teléfono"),{isValid:!1,errors:l,suggestions:g};const x=this.phonePatterns[m];return x?(N.length<x.minLength?(l.push(`El número es muy corto. Debe tener ${x.minLength} dígitos`),g.push(`Ejemplo para ${this.getCountryName(m)}: ${x.example}`)):N.length>x.maxLength?(l.push(`El número es muy largo. Debe tener ${x.maxLength} dígitos`),g.push(`Ejemplo para ${this.getCountryName(m)}: ${x.example}`)):x.pattern.test(N)||(l.push(`Formato inválido para ${this.getCountryName(m)}`),g.push(`Debe ser: ${x.description}`),g.push(`Ejemplo: ${x.example}`)),{isValid:l.length===0,errors:l,suggestions:g}):((N.length<7||N.length>15)&&l.push("El número debe tener entre 7 y 15 dígitos"),{isValid:l.length===0,errors:l,suggestions:g})}static getCountryName(u){return{CL:"Chile",AR:"Argentina",BR:"Brasil",CO:"Colombia",PE:"Perú",UY:"Uruguay",PY:"Paraguay",EC:"Ecuador",BO:"Bolivia",VE:"Venezuela",US:"Estados Unidos",ES:"España",MX:"México"}[u]||"Este país"}static cleanPhone(u){return u.replace(/[^0-9]/g,"")}static formatPhone(u,m){const l=this.cleanPhone(u);switch(m){case"CL":case"PE":case"PY":if(l.length===9)return`${l.substring(0,1)} ${l.substring(1,5)} ${l.substring(5)}`;break;case"US":if(l.length===10)return`(${l.substring(0,3)}) ${l.substring(3,6)}-${l.substring(6)}`;break}return l}static getPatternInfo(u){const m=this.phonePatterns[u];return m?{description:m.description,example:m.example}:null}}function et({calendarId:v="ricardo.huiscaleo@gmail.com",title:u="Asesoría Personalizada en Soluciones con IA",description:m="Selecciona fecha y hora para programar una reunión",accentColor:l="#3B82F6",className:g="",workingHoursStart:N=9,workingHoursEnd:x=22,slotDuration:f=60,timeZone:D="America/Santiago",sessionDuration:C=30,sessionPrice:b="FREE"}){const[P,k]=c.useState(1),[p,W]=c.useState(null),[R,T]=c.useState(null),[Ye,Q]=c.useState([]),[le,V]=c.useState([]),[H,U]=c.useState(!0),[I,ye]=c.useState(!1),[F,w]=c.useState(null),[B,Le]=c.useState(Ee(new Date)),[h,ee]=c.useState({nombre:"",email:"",telefono:"",notas:""}),[M,Ae]=c.useState({code:"+56",country:"CL",name:"Chile",flag:"🇨🇱"}),[A,O]=c.useState({}),[te,ie]=c.useState([]),[se,ce]=c.useState([]),[de,_]=c.useState(null),[$,me]=c.useState(null),[ue,ae]=c.useState(null),[Ne,Y]=c.useState(!1),[we,xe]=c.useState(null),he={2:{title:"👤 Procesando Información",subtitle:"La IA está validando y procesando tu información personal de forma segura",phases:["Verificando información personal","Validando formato de contacto","Protegiendo datos sensibles","Preparando perfil de reserva","Finalizando validación"]}},De="https://primary-production-33e8.up.railway.app/webhook/156b71d9-9b89-4c39-9f45-3f098923054f",Re="https://primary-production-33e8.up.railway.app/webhook/20eb2a0b-10c6-44ca-9269-3e0597d40216",Pe="https://primary-production-33e8.up.railway.app/webhook/415c2a5f-3613-4a5f-9743-6746714a9f63",Se="https://primary-production-33e8.up.railway.app/webhook/6f5614ee-d92b-4b9a-aec0-231ae6b0defd",Te=10*60*1e3,$e=c.useRef(null),ge=c.useRef(null),pe=c.useRef(!1);c.useEffect(()=>{pe.current=!0},[]),c.useEffect(()=>()=>{ne()},[]),c.useEffect(()=>{B&&pe.current&&G(B)},[B,v,D]),c.useEffect(()=>{if(Ne&&(alert("Tu horario reservado temporalmente ha expirado. Por favor, selecciona de nuevo."),k(1),T(null),Y(!1),p)){const t=re(p);Q(t)}},[Ne]);function Ee(t){const s=new Date(t);return s.setHours(0,0,0,0),s}const q=(t,s={})=>{console.log(`[Analytics] ${t}:`,s)},re=t=>{if(!t)return[];const s=new Date;if(s.setHours(0,0,0,0),t<s||[0,6].includes(t.getDay()))return[];const a=[],n=new Date;for(let d=N;d<x;d++)for(let o=0;o<60;o+=f){const j=new Date(t);j.setHours(d,o,0,0);const S=new Date(j.getTime()+f*6e4);t.toDateString()===n.toDateString()&&j<=n||a.push({start:j,end:S,available:!0})}return le.filter(d=>{if(!d?.start?.dateTime)return!1;const o=new Date(d.start.dateTime);return o.getDate()===t.getDate()&&o.getMonth()===t.getMonth()&&o.getFullYear()===t.getFullYear()}).forEach(d=>{const o=new Date(d.start.dateTime),j=new Date(d.end.dateTime);for(let S=0;S<a.length;S++){const y=a[S];(y.start>=o&&y.start<j||y.end>o&&y.end<=j||y.start<=o&&y.end>=j)&&(a[S]={...y,available:!1,eventSummary:d.summary})}}),a.filter(d=>d.available)},ze=async t=>{$&&await J($,!0);try{U(!0);const s={start:t.start.toISOString(),end:new Date(t.start.getTime()+C*6e4).toISOString(),summary:`Reserva Temporal - ${h.email||"Usuario Pendiente"}`,calendarId:v,timeZone:D},a=await fetch(Pe,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok){const r=await a.json().catch(()=>({message:"Error en la respuesta del servidor",error:"Respuesta no JSON"}));throw new Error(r.message||r.error||`Error ${a.status} creando bloqueo`)}const n=await a.json();if(n.id){me(n.id),Ie(Te/1e3),Y(!1);const r={id:n.id,summary:s.summary,start:{dateTime:s.start},end:{dateTime:s.end},isTempBlock:!0};return V(d=>[...d,r]),p&&fe(p,!0),!0}return!1}catch(s){return console.error("Error creando bloqueo temporal:",s),w(`No se pudo reservar el horario temporalmente: ${s.message}`),!1}finally{U(!1)}},J=async(t=$,s=!1)=>{if(t)try{const a=await fetch(Se,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({eventId:t,calendarId:v})});if(!a.ok){const n=await a.json().catch(()=>({}));throw new Error(n.message||n.error||`Error ${a.status} eliminando bloqueo`)}V(n=>n.filter(r=>r.id!==t)),t===$&&(me(null),s||ae(null),ne()),p&&!s&&fe(p)}catch(a){console.error("Error eliminando bloqueo temporal:",a),w(`Problema al liberar el horario: ${a.message}. Intenta seleccionar de nuevo.`)}},Ie=t=>{ne(),Y(!1);let s=t;ae(s);const a=setInterval(()=>{s-=1,ae(s),s<=0&&(clearInterval(a),xe(null),Y(!0),J())},1e3);xe(a)},ne=()=>{we&&(clearInterval(we),xe(null))},G=async(t,s=0)=>{const n=[1e3,2e3,5e3];if(typeof window>"u"||!pe.current){V([]),U(!1);return}U(!0),w(null);try{const r=new Date(t);r.setDate(t.getDate()+13),r.setHours(23,59,59,999);const d=new URL(De);d.searchParams.append("timeMin",t.toISOString()),d.searchParams.append("timeMax",r.toISOString()),d.searchParams.append("maxResults","100"),d.searchParams.append("timeZone",D),d.searchParams.append("calendarId",v);const o=new AbortController,j=setTimeout(()=>o.abort(),15e3),S=await fetch(d.toString(),{method:"GET",signal:o.signal,headers:{Accept:"application/json","Cache-Control":"no-cache"}});if(clearTimeout(j),!S.ok)throw new Error(`Error del servidor: ${S.status} - ${S.statusText}`);const y=await S.text();if(y.trim()==="PRO FEATURE ONLY"){console.warn("Webhook devolvió PRO FEATURE ONLY - usando datos simulados para desarrollo");const i=[],z=!0;V([]),w(null),q("week_loaded",{eventsCount:0,parseSuccess:!0,retryCount:s,note:"Usando datos simulados - webhook limitado"});return}let E=[],L=!1;if(y.trim().startsWith("[")&&y.trim().endsWith("]"))try{E=JSON.parse(y),Array.isArray(E)&&(L=!0)}catch{}if(!L)try{const i=JSON.parse(y);if(i){if(i.items&&Array.isArray(i.items))E=i.items,L=!0;else if(i.events&&Array.isArray(i.events))E=i.events,L=!0;else if(Array.isArray(i))E=i,L=!0;else{for(const z in i)if(Array.isArray(i[z])&&i[z].length>0&&typeof i[z][0]=="object"&&i[z][0].hasOwnProperty("start")){E=i[z],L=!0;break}if(!L){for(const z in i)if(typeof i[z]=="string"&&(i[z].includes('"start":')||i[z].includes('"id":')))try{const X=JSON.parse(i[z]);if(Array.isArray(X)){E=X,L=!0;break}else if(X.items&&Array.isArray(X.items)){E=X.items,L=!0;break}}catch{}}}!L&&i.id&&(i.start||i.startDate)&&(E=[i],L=!0)}}catch{}if(!L){const i=y.match(/\[\s*\{[\s\S]*?\}\s*\]/s);if(i&&i[0])try{E=JSON.parse(i[0]),Array.isArray(E)&&(L=!0)}catch{}}L||(E=[]);const je=E.filter(i=>i.start&&i.start.dateTime&&i.end&&i.end.dateTime);je.length,E.length,V(je),w(null),q("week_loaded",{eventsCount:je.length,parseSuccess:L,retryCount:s})}catch(r){if(console.error("Error cargando eventos:",r),(r.name==="AbortError"||r.message.includes("Load failed")||r.message.includes("fetch")||r.message.includes("network")||r.message.includes("timeout")||r.message.includes("Error del servidor")&&r.message.includes("5"))&&s<3){const j=n[s];w(`Problemas de conexión. Reintentando automáticamente... (${s+1}/3)`),setTimeout(()=>{G(t,s+1)},j);return}let o="No se pudieron cargar los eventos del calendario.";r.name==="AbortError"?o="La conexión se agotó. Verifica tu conexión a internet.":r.message.includes("Load failed")?o="Error de red. Verifica tu conexión a internet y reinténtalo.":r.message.includes("Error del servidor")&&(o="El servidor está temporalmente no disponible. Inténtalo en unos minutos."),w(o),V([])}finally{(s>=3||!F||!F.includes("Reintentando"))&&U(!1)}},Ce=async t=>{U(!0),W(null),T(null),Q([]);const s=new Date(B);s.setDate(B.getDate()+t*7),Le(s)},fe=(t,s=!1)=>{W(t),s||T(null);const a=re(t);Q(a),w(null),q("date_selected",{date:t.toISOString(),slotsCount:a.length})},Be=async t=>{w(null),T(t),await ze(t)?q("time_slot_selected",{slotStart:t.start.toISOString()}):T(null)},oe=t=>{const{name:s,value:a}=t.target;if(s==="telefono"){const n=a.replace(/[^0-9\s\-\+]/g,"");if(ee(r=>({...r,[s]:n})),ge.current&&ge.current.close(),n.trim().length>0){const r=Z.validatePhone(n,M.country);ce(r.suggestions||[]),!r.isValid&&r.errors.length>0?O(d=>({...d,telefono:r.errors[0]})):O(d=>({...d,telefono:null}))}else ce([]),O(r=>({...r,telefono:null}))}else if(s==="email"){const n=K.normalize(a);if(ee(r=>({...r,[s]:n})),n.trim().length>0){const r=K.validateEmail(n);ie(r.warnings||[]),!r.isValid&&r.errors.length>0?O(d=>({...d,email:r.errors[0]})):O(d=>({...d,email:null}))}else ie([]),O(r=>({...r,email:null}))}else ee(n=>({...n,[s]:a}));A[s]&&s!=="email"&&O(n=>({...n,[s]:null}))},Oe=()=>{const t={};if(h.nombre.trim()?h.nombre.trim().length<2&&(t.nombre="El nombre debe tener al menos 2 caracteres"):t.nombre="El nombre es requerido",!h.email.trim())t.email="El email es requerido";else{const s=K.validateEmail(h.email);s.isValid||(t.email=s.errors[0]||"El email no es válido"),ie(s.warnings||[])}if(!h.telefono.trim())t.telefono="El teléfono es requerido";else{const s=Z.validatePhone(h.telefono,M.country);s.isValid||(t.telefono=s.errors[0]||"El teléfono no es válido"),ce(s.suggestions||[])}return O(t),Object.keys(t).length===0},ke=async t=>{if(t&&t.preventDefault(),!R||!p){w("No se ha seleccionado fecha y hora");return}ye(!0),w(null),_(null);const s=R.start,a=new Date(s.getTime()+C*6e4);let n=!1;if($)try{const o=await fetch(Se,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({eventId:$,calendarId:v})});if(o.ok)n=!0;else{const j=await o.json().catch(()=>({}));console.warn(`Advertencia: No se pudo eliminar el bloqueo temporal (${$}). Error: ${j.error||o.status}. Continuando con la creación de la reserva...`)}}catch(o){console.error("Error crítico eliminando bloqueo temporal:",o)}const r=$;ne(),me(null),ae(null),Y(!1),r&&V(o=>o.filter(j=>j.id!==r));const d={nombre:h.nombre,email:h.email,telefono:`${M.code} ${h.telefono}`,start:s.toISOString(),end:a.toISOString(),notas:h.notas,calendarId:v,timeZone:D};try{const o=await fetch(Re,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!o.ok){let S=`Error ${o.status} al crear la reserva.`;try{const y=await o.json();S=y.message||y.error||JSON.stringify(y)}catch{const E=await o.text().catch(()=>"No se pudo leer el cuerpo del error de creación.");S+=` Cuerpo no JSON: ${E.substring(0,100)}...`}throw new Error(S)}const j=await o.json().catch(()=>({id:"N/A - Reserva creada, respuesta no JSON"}));_("success"),q("booking_success_v2_client_orchestrated",{eventId:j.id}),G(B)}catch(o){console.error("Error final creando la reserva:",o),w(o.message||"Error al crear la reserva final."),_("error")}finally{ye(!1)}},be=()=>{if(P===1){if(!R){w("Por favor, selecciona un horario antes de continuar.");return}w(null),k(2)}else P===2&&Oe()&&(!b||b.trim()==="$0"||b.toLowerCase().includes("gratis")?ke():k(3))},ve=async()=>{w(null),_(null),P===2?(k(1),$&&(await J(),T(null))):P===3&&k(2)},Me=()=>{const t=new Date;t.setHours(0,0,0,0);const s=[];for(let a=0;a<14;a++){const n=new Date(B);n.setDate(B.getDate()+a),n.setHours(0,0,0,0);const r=n<t,d=[0,6].includes(n.getDay()),o=!r&&!d,S=(o?re(n):[]).length;s.push({date:n,isPast:r,isWeekend:d,isSelectable:o,slotsCount:S,isToday:n.toDateString()===t.toDateString()})}return e.jsxs("div",{className:"horizontal-calendar-container",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>Ce(-1),disabled:H,className:"p-2 rounded-lg bg-gray-100 hover:bg-gray-200 disabled:opacity-50 transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:B.toLocaleDateString("es-CL",{month:"long",year:"numeric"})}),e.jsx("button",{onClick:()=>Ce(1),disabled:H,className:"p-2 rounded-lg bg-gray-100 hover:bg-gray-200 disabled:opacity-50 transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})})]}),e.jsx("div",{className:"horizontal-dates-grid overflow-x-auto pb-4",children:e.jsx("div",{className:"flex gap-3 min-w-max px-2",children:s.map((a,n)=>{const r=p&&a.date.getTime()===p.getTime();return e.jsxs("button",{onClick:()=>a.isSelectable&&fe(a.date),disabled:!a.isSelectable,className:`
                    date-card flex-shrink-0 w-20 h-24 p-3 rounded-xl border-2 transition-all duration-200
                    flex flex-col items-center justify-center text-center
                    ${r?"border-blue-500 bg-blue-50 shadow-lg transform scale-105":a.isSelectable?a.slotsCount>0?"border-green-300 bg-green-50 hover:border-green-400 hover:bg-green-100 hover:scale-102":"border-red-300 bg-red-50":"border-gray-200 bg-gray-50 opacity-50 cursor-not-allowed"}
                  `,children:[e.jsx("div",{className:`
                    text-xl font-bold mb-1
                    ${r?"text-blue-700":a.isSelectable?a.slotsCount>0?"text-green-700":"text-red-600":"text-gray-400"}
                  `,children:a.date.getDate()}),e.jsx("div",{className:`
                    text-xs font-medium mb-1
                    ${r?"text-blue-600":a.isSelectable?"text-gray-600":"text-gray-400"}
                  `,children:a.date.toLocaleDateString("es-CL",{weekday:"short"}).toUpperCase()}),e.jsx("div",{className:`
                    text-xs font-semibold
                    ${r?"text-blue-600":a.isSelectable?a.slotsCount>0?"text-green-600":"text-red-500":"text-gray-400"}
                  `,children:a.isSelectable?`${a.slotsCount}`:"—"}),a.isToday&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-orange-400 rounded-full border-2 border-white"})]},n)})})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mt-4 text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full"}),e.jsx("span",{children:"Disponible"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-red-400 rounded-full"}),e.jsx("span",{children:"Sin horarios"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-400 rounded-full"}),e.jsx("span",{children:"No disponible"})]})]})]})},Ve=()=>{if(!p)return null;const t=re(p);return t.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-3 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"text-sm",children:"No hay horarios disponibles para esta fecha"})]}):e.jsxs("div",{className:"time-slots-container",children:[e.jsxs("div",{className:"mb-4 text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-1",children:p.toLocaleDateString("es-CL",{weekday:"long",day:"numeric",month:"long"})}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.length," horarios disponibles"]})]}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-3",children:t.map((s,a)=>{const n=R&&R.start.getTime()===s.start.getTime();return e.jsx("button",{onClick:()=>Be(s),disabled:H,className:`
                  time-slot-button p-3 rounded-lg border-2 transition-all duration-200
                  text-sm font-medium text-center
                  ${n?"border-blue-500 bg-blue-500 text-white shadow-lg transform scale-105":"border-gray-300 bg-white text-gray-700 hover:border-blue-400 hover:bg-blue-50 hover:scale-102"}
                  ${H?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                `,children:s.start.toLocaleTimeString("es-CL",{hour:"2-digit",minute:"2-digit",hour12:!1})},a)})}),R&&e.jsx("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-1",children:"✓ Horario reservado temporalmente"}),e.jsxs("p",{className:"text-sm text-blue-700",children:[p.toLocaleDateString("es-CL",{weekday:"long",day:"numeric",month:"long"})," a las ",R.start.toLocaleTimeString("es-CL",{hour:"2-digit",minute:"2-digit"})," • Duración: ",C," min"]}),ue&&e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["⏱️ Tiempo restante: ",Math.floor(ue/60),":",(ue%60).toString().padStart(2,"0")]})]}),e.jsx("button",{onClick:()=>{T(null),$&&J()},className:"text-blue-600 hover:text-blue-800 text-sm font-medium px-3 py-1 rounded hover:bg-blue-100 transition-colors",children:"Cambiar"})]})})]})},Fe=()=>{switch(P){case 1:return e.jsx("div",{className:"horizontal-booking-flow",children:H&&!le.length?e.jsx(He,{step:1,loadingState:"calendar",progress:75}):F&&!le.length?e.jsxs("div",{className:"py-10 text-center text-red-600 bg-red-50 p-4 rounded-md",children:[e.jsx("p",{children:F}),e.jsx("button",{onClick:()=>G(B),className:"mt-2 text-sm text-blue-600 hover:underline",children:"Reintentar carga"})]}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-blue-300 mb-2",children:"Selecciona fecha y hora"}),e.jsx("p",{className:"text-blue-200",children:"Elige tu horario preferido para la consultoría"})]}),e.jsx("div",{className:"bg-white rounded-xl border shadow-sm p-6",children:Me()}),p&&e.jsxs("div",{className:"bg-white rounded-xl border shadow-sm p-6",children:[Ve(),e.jsxs("div",{className:"flex justify-between mt-6 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:ve,disabled:P===1||I,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:"← Atrás"}),P<3&&e.jsx("button",{onClick:be,disabled:I||H||P===1&&!R,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:I?"Procesando...":"Continuar →"})]})]}),e.jsxs("div",{className:"text-center text-sm text-cyan-300 space-y-1",children:[e.jsxs("p",{children:["💻 Sesión virtual de ",C," min por Google Meet • ",b]}),e.jsx("p",{className:"text-xs text-blue-200",children:"Consultoría personalizada con análisis y propuesta técnica"})]})]})});case 2:return e.jsx("div",{className:"space-y-6",children:I?e.jsx(Ue,{step:2,loadingState:"processing",progress:60,title:he[2]?.title,subtitle:he[2]?.subtitle,phases:he[2]?.phases}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent mb-2",children:"Información de contacto"}),e.jsx("p",{className:"text-sm text-cyan-300",children:"Completa tus datos para confirmar la reserva"})]}),e.jsxs("form",{className:"space-y-4",onSubmit:t=>{t.preventDefault(),be()},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"nombre",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre completo *"}),e.jsx("input",{type:"text",id:"nombre",name:"nombre",value:h.nombre,onChange:oe,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 ${A.nombre?"border-red-500":"border-gray-300"}`,placeholder:"Tu nombre completo"}),A.nombre&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:A.nombre})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"telefono",className:"block text-sm font-medium text-gray-700 mb-1",children:"Teléfono *"}),e.jsxs("div",{className:"flex",children:[e.jsx(Xe,{ref:ge,selectedCountry:M,onCountryChange:Ae}),e.jsx("input",{type:"tel",id:"telefono",name:"telefono",value:h.telefono,onChange:oe,className:`flex-1 px-3 py-2 border rounded-r-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 ${A.telefono?"border-red-500":se.length>0?"border-blue-500":"border-gray-300"}`,placeholder:Z.getPatternInfo(M.country)?.example||"9 XXXX XXXX"})]}),A.telefono&&e.jsxs("p",{className:"text-red-300 text-xs mt-1 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),A.telefono]}),!A.telefono&&se.length>0&&e.jsx("div",{className:"mt-1",children:se.map((t,s)=>e.jsxs("p",{className:"text-blue-600 text-xs flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"💡 ",t]},s))}),!A.telefono&&!se.length&&h.telefono.trim()&&Z.validatePhone(h.telefono,M.country).isValid&&e.jsxs("p",{className:"text-green-500 text-xs mt-1 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"✓ Número válido para"," ",Z.getPatternInfo(M.country)?M.name:"este país"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),e.jsx("input",{type:"email",id:"email",name:"email",value:h.email,onChange:oe,className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900 ${A.email?"border-red-500":te.length>0?"border-yellow-500":"border-gray-300"}`,placeholder:"tu.email@empresa.com"}),A.email&&e.jsxs("p",{className:"text-red-300 text-xs mt-1 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),A.email]}),!A.email&&te.length>0&&e.jsx("div",{className:"mt-1",children:te.map((t,s)=>e.jsxs("p",{className:"text-yellow-600 text-xs flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"⚠️ ",t]},s))}),!A.email&&!te.length&&h.email.trim()&&K.isValidFormat(h.email)&&e.jsxs("p",{className:"text-green-500 text-xs mt-1 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"✓ Email válido"," ",K.isPopularDomain(h.email)?"(dominio confiable)":""]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notas",className:"block text-sm font-medium text-gray-700 mb-1",children:"Notas adicionales (opcional)"}),e.jsx("textarea",{id:"notas",name:"notas",value:h.notas,onChange:oe,rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900",placeholder:"Cuéntanos brevemente sobre tu empresa o necesidades específicas..."})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Resumen de tu cita"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha:"})," ",p?.toLocaleDateString("es-CL",{weekday:"long",day:"numeric",month:"long",year:"numeric"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Hora:"})," ",R?.start.toLocaleTimeString("es-CL",{hour:"2-digit",minute:"2-digit"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Duración:"})," ",C," minutos"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Modalidad:"})," Virtual (Meet)"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Precio:"})," ",b]})]})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:ve,disabled:I,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:"← Atrás"}),e.jsx("button",{onClick:be,disabled:I,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:I?"Procesando...":!b||b.trim()==="$0"||b.toLowerCase().includes("gratis")||b.toLowerCase().includes("free")?"Confirmar Reserva":"Continuar →"})]})]})});case 3:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold bg-gradient-to-r from-emerald-400 to-teal-400 bg-clip-text text-transparent mb-2",children:"Finalizar reserva"}),e.jsx("p",{className:"text-sm text-purple-300",children:"Revisa los detalles y confirma tu reserva"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 border",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-4",children:"Detalles de la reserva"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:e.jsx("strong",{children:"Fecha:"})}),e.jsx("p",{className:"text-gray-900",children:p?.toLocaleDateString("es-CL",{weekday:"long",day:"numeric",month:"long",year:"numeric"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:e.jsx("strong",{children:"Hora:"})}),e.jsx("p",{className:"text-gray-900",children:R?.start.toLocaleTimeString("es-CL",{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:e.jsx("strong",{children:"Nombre:"})}),e.jsx("p",{className:"text-gray-900",children:h.nombre})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:e.jsx("strong",{children:"Email:"})}),e.jsx("p",{className:"text-gray-900",children:h.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:e.jsx("strong",{children:"Teléfono:"})}),e.jsx("p",{className:"text-gray-900",children:h.telefono})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:e.jsx("strong",{children:"Precio:"})}),e.jsx("p",{className:"text-lg font-semibold text-green-600",children:b})]})]}),h.notas&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-gray-600",children:e.jsx("strong",{children:"Notas:"})}),e.jsx("p",{className:"text-sm text-gray-900",children:h.notas})]})]}),e.jsx("button",{onClick:ke,disabled:I,className:"w-full py-3 px-4 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:I?"Procesando...":"Confirmar Reserva"}),e.jsx("div",{className:"flex justify-between pt-4 border-t border-gray-200",children:e.jsx("button",{onClick:ve,disabled:I,className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium",children:"← Atrás"})})]});default:return null}},_e=()=>{const t=["Horario","Datos","Confirmar"];return!b||b.trim()==="$0"||b.toLowerCase().includes("gratis")||(t[2]="Pago"),e.jsx("nav",{"aria-label":"Progreso de la reserva",className:"mb-8",children:e.jsx("ol",{role:"list",className:"flex items-center justify-center space-x-8",children:t.map((a,n)=>e.jsxs("li",{className:"flex items-center",children:[P>n+1?e.jsxs("div",{className:"flex items-center text-blue-300",children:[e.jsx("span",{className:"flex-shrink-0 w-8 h-8 flex items-center justify-center bg-blue-400 rounded-full",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{className:"ml-2 text-sm font-medium text-blue-300",children:a})]}):P===n+1?e.jsxs("div",{className:"flex items-center text-blue-300",children:[e.jsx("span",{className:"flex-shrink-0 w-8 h-8 flex items-center justify-center border-2 border-blue-400 rounded-full",children:e.jsx("span",{className:"text-blue-300 font-medium",children:n+1})}),e.jsx("span",{className:"ml-2 text-sm font-medium text-blue-300",children:a})]}):e.jsxs("div",{className:"flex items-center text-gray-300",children:[e.jsx("span",{className:"flex-shrink-0 w-8 h-8 flex items-center justify-center border-2 border-gray-400 rounded-full",children:e.jsx("span",{className:"text-gray-300 font-medium",children:n+1})}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-300",children:a})]}),n!==t.length-1&&e.jsx("div",{className:"ml-4 w-16 h-0.5 bg-gray-400"})]},a))})})},We=()=>de==="success"?e.jsxs("div",{className:"text-center py-8 px-4",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-gradient-to-br from-orange-100 to-amber-100 rounded-full flex items-center justify-center mb-4 shadow-lg",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-orange-600",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]})}),e.jsx("h3",{className:"text-3xl font-bold mb-3 bg-gradient-to-r from-green-400 to-emerald-200 bg-clip-text text-transparent",children:"¡Reserva Confirmada!"}),e.jsxs("p",{className:"text-lg text-white mb-2 font-medium",children:["Tu asesoría para el"," ",e.jsx("span",{className:"text-cyan-300 font-semibold",children:p?.toLocaleDateString("es-CL",{weekday:"long",day:"numeric",month:"long"})})," a las ",e.jsx("span",{className:"text-cyan-300 font-semibold",children:R?.start.toLocaleTimeString("es-CL",{hour:"2-digit",minute:"2-digit"})})," ha sido confirmada."]}),e.jsxs("p",{className:"text-sm text-orange-200 mb-6 font-medium",children:["Recibirás un correo electrónico con los detalles en"," ",e.jsx("span",{className:"text-white font-semibold",children:h.email}),"."]}),e.jsx("button",{onClick:()=>{k(1),W(null),T(null),Q([]),ee({nombre:"",email:"",telefono:"",notas:""}),O({}),_(null),w(null),G(Ee(new Date))},className:"py-3 px-8 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-lg hover:from-orange-600 hover:to-amber-600 transition-all duration-300 text-sm font-semibold shadow-lg hover:shadow-xl transform hover:scale-105",children:"Realizar otra reserva"})]}):de==="error"?e.jsxs("div",{className:"text-center py-8 px-4",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-red-600",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]})}),e.jsx("h3",{className:"text-2xl font-bold mb-3 text-gray-800",children:"Error en la Reserva"}),e.jsx("p",{className:"text-red-600 mb-6",children:F||"No se pudo completar la reserva. Por favor, intenta de nuevo."}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-3",children:[e.jsx("button",{onClick:()=>{_(null),w(null)},className:"py-2.5 px-6 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm font-medium",children:"Volver a Intentar"}),e.jsx("button",{onClick:async()=>{_(null),w(null),k(1),W(null),T(null),$&&await J($)},className:"py-2.5 px-6 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors text-sm font-medium",children:"Seleccionar otro horario"})]})]}):null;return de?e.jsx("div",{className:`max-w-4xl mx-auto px-4 ${g}`,children:We()}):e.jsxs("div",{className:`max-w-6xl mx-auto px-4 py-8 ${g}`,ref:$e,children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:u}),e.jsx("p",{className:"text-lg text-gray-600",children:m})]}),_e(),F&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border-l-4 border-red-400 rounded-r-md",children:e.jsx("p",{className:"text-red-700 text-sm",children:F})}),Fe()]})}export{et as default};
